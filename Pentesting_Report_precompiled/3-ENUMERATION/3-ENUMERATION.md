# Enumeration
...
## FTP (port 21)
FTP uses port 21 (TCP). To check whether this port is opened, we can run `nmap -p 21 [Target IP address]`.

Then, we can connect to it using `ftp [Target IP address]` and it require username and password to login.

Very often, the default credentials of FTP are:

- Username: anonymous
- Password: any.

Otherwise, a bruteforce approach is needed: `hydra [-L users.txt or -l user_name] [-P pass.txt or -p password] -f ftp://[Target IP Address]`.

When we are inside an FTP server, we can see which commands can be used by typing `help`.

## SMTP (port 25)
SMTP uses mail exchange (MX) servers to direct mail via DNS. It runs on port 25 (TCP).

We can use Nmap NSE scripts to enumerate the SMTP service:
- Displaying a list of all the possible mail users on the target machine: `nmap -p 25 --script=smtp-enum-users [Target IP Address]`
- Displaying a list of open SMTP relays on the target machine: `nmap -p 25 --script=smtp-open-relay [Target IP Address]`

- List of all the SMTP commands available in the Nmap directory appears: `nmap -p 25 --script=smtp-commands [Target IP Address]`

## DNS (port 53)
DNS uses port 53 (UDP). To check whether this port is opened, we can run `nmap -sU -p 53 [Target IP address]`.

We are interesting in the "Zone Transfer" mode enabled (AXFR), i.e., the process of replicating DNS records across DNS servers (from the primary DNS server to a secondary DNS server).

AXFR offers no authentication, so any client can ask a DNS server for a copy of the entire zone. This means that unless some kind of protection is introduced, an attacker can get a list of all hosts for a domain, which gives them a lot of potential attack vectors.

### DNSRecon
It is used to obtain the internal records of the target DNS server if the DNS zone is not properly configured. The enumerated zone information can assist us in building a host network map.

ðŸ”¥Â [dnsrecon.py](https://github.com/darkoperator/dnsrecon)

`python3 dnsrecon.py -d [Target domain] -z`

`-d` specifies the target domain and `-z` specifies that the DNSSEC zone walk be performed with standard enumeration.

### Nmap
- It displays a list of all the available DNS services on the target host along with their associated ports: `nmap --script=broadcast-dns-service-discovery [Target Domain]`

- It displays a list of all the subdomains associated with the target host along with their IP addresses: `nmap -T4 -p 53 --script dns-brute [Target Domain]`

- It displays various common service (SRV) records for a given domain name: `nmap --script dns-srv-enum --script-args "dns-srv-enum.domain='[Target Domain]'"`

# NetBIOS (ports 137-139)
Windows uses NetBIOS (*Network Basic Input Output System*) for file and printer sharing. 

NetBIOS uses ports 137, 138 and 139 (TCP and UDP). 

A NetBIOS name is a unique computer name assigned to Windows systems, comprising a 16-character ASCII string that identifies the network device over TCP/IP. The first 15 characters are used for the device name, and the 16th is reserved for the service or name record type.

## Nbtscan

It sends NetBIOS status query to each address in the supplied IP address range. For each responded host, it lists IP address, NetBIOS computer name, logged-in user name and MAC address (such as Ethernet).

ðŸ”¥Â [nbtscan](https://github.com/resurrecting-open-source-projects/nbtscan)

- Scan the whole class network: `nbtscan -r [IP Network Address]/[CIDR]`

- Scan a range from 192.168.1.25 to 192.168.1.137: `nbtscan 192.168.1.25-137`

## Nmap NSE script

NSE scripts can be used for discovering NetBIOS shares on the network. 

For example, using the nbstat NSE script, we can retrieve the targetâ€™s NetBIOS names and MAC addresses. Moreover, increasing verbosity allows you to extract all names related to the system.

- `nmap -sV -v --script nbstat.nse [Target IP Address]`
- `nmap -sU -p 137 --script nbstat.nse [Target IP Address]`

## **Windows Command-Line Utilities**

### Nbtstat
It helps in troubleshooting NetBIOS name resolution problems. This command removes and corrects preloaded entries using several case-sensitive switches. It can be used to enumerate information such as NetBIOS over TCP/IP (NetBT) protocol statistics, NetBIOS name tables for both the local and remote computers, and the NetBIOS name cache.

- `nbtstat -a [IP address of the remote machine]`: `-a` displays the NetBIOS name table of a remote computer.
- `nbtstat -c`: `-c` lists the contents of the NetBIOS name cache of the remote computer.

### Net
It displays information about the target such as connection status, shared folder/drive and network information. 

The command is: `net use`.

Using this information, the attackers can read or write to a remote computer system, depending on the availability of shares, or even launch a DoS attack.

# LDAP (port 389)
LDAP (*Lightweight Directory Access Protocol*) is an Internet protocol for accessing distributed directory services over a network. LDAP uses DNS for quick lookups and fast resolution of queries. 

A client starts an LDAP session by connecting to a DSA (*Directory System Agent*), typically on port 389 (TCP), and sends an operation request to the DSA, which then responds. BER (*Basic Encoding Rules*) is used to transmit information between the client and the server. 

One can anonymously query the LDAP service for sensitive information such as usernames, addresses, departmental details, and server names.

## Ldapsearch
It opens a connection to an LDAP server, binds the connection, and performs a search using the specified parameters. 

The filter should conform to the string representation for search filters as defined in RFC 4515. If not provided, the default filter, i.e. `(objectClass=*)`, is used.

### Gather Information related to the naming contexts
`ldapsearch -x -H ldap://[Target IP Address] -s base namingcontexts`

`-x` specifies simple authentication, `-H` specifies the host, `-s` specifies the scope.

### Obtain more information about the primary domain
`ldapsearch -x -H ldap://[Target IP Address] -b "*DC=CEH,DC=com"*`

`-x` specifies simple authentication, `-H` specifies the host, `-b` the base domain name for search.

### Retrieve information related to all the objects in the directory tree
`ldapsearch -x -H ldap://[Target IP Address] -b "*DC=CEH,DC=com*" "objectclass=*"`

`-x` specifies simple authentication, `-H` specifies the host, `-b` the base domain name for search.

### Blind authentication
`ldapsearch -x -H ldap://[Target IP Address] -b "DC=CEH,DC=com" "objectclass=*" -D '' -w ''`

`-x` specifies simple authentication, `-H` specifies the host, `-b` the base domain name for search, `-D` blind authentication.

## Nmap NSE script

We can use NSE script to perform username enumeration on the target machine.

Nmap attempts to brute-force LDAP authentication and displays the usernames that are found.

First, letâ€™s see if the port 389 is open using `nmap -sU -p 389 [Target IP address]`.

Then, we can use `ldap-brute` to perform brute-force LDAP authentication. `ldap.base` if set, the script will use it as a base for the password guessing attempts:

`nmap -p 389 --script ldap-brute --script-args ldap.base='"cn=users,dc=CEH,dc=com"' [Target IP Address]`




















